<script>
  _500px.init({
    sdk_key: '29f8908d90c874398a67d534c33d79f6cb652ec5'
  });
</script>

<%= form_for(@dream) do |f| %>
	<% if @dream.errors.any? %>
		<%= render 'shared/error_messages', object: @dream %>
	<% end %>
  <ul id="myTab" class="nav nav-tabs">
    <li><a href="#tab_dream" data-toggle="pill">Enter Dream</a></li>
    <li><a href="#tab_image" data-toggle="pill">Dream Image</a></li>
    <li><a href="#tab_details" data-toggle="pill">More Details</a></li>
  </ul>
  <div class="tab-content" id="myTabContent">
  	<div id="tab_dream" class="tab-pane fade in active">
  		<%= f.text_field :title, :placeholder => "Dream title" %> <br />
			<%= f.text_area :content, :placeholder => "Narrate your dream..." %> <br />
			<%= f.radio_button :privacy, "true" %>
			<%= f.label(:private_true, "Private") %>
			<%= f.radio_button :privacy, "false" %>
			<%= f.label(:private_false, "Public") %>
		</div>
		<div id="tab_image" class="tab-pane fade in">
  		<label>Search your image: </label>
			<form action="#" method="post" id="search_form">
				<input id="search_input"/> 
				<a class="btn btn-primary btn-small search_button">Go</a>
			</form>
			<ol id="selectable">
			</ol>
			<li id="loadMore"></li>
		</div>
  	<div id="tab_details" class="tab-pane fade in">
  		<div class="field">
				<%= f.check_box :nightmare %>
				<%= label(:nightmare, "Nightmare") %>
				<%= f.check_box :lucid %>
				<%= label(:lucid, "Lucid") %>
				<%= f.check_box :recurring %>
				<%= label(:recurring, "Recurring") %>
				<%= f.check_box :fragmented %>
				<%= label(:fragmented, "Fragmented") %>
			</div>
			<div class="field">
				<% if @dream.emotion %>
					<% @menu_blank = @dream.emotion %>
				<% else %>
					<% @menu_blank = "Select Emotion" %>
				<% end %>
				<%= f.select :emotion, ([["Inspired", "Inspired"], ["Relieved", "Relieved"], ["Afraid", 
					"Afraid"], ["Sad", "Sad"], ["Surprised", "Surprised"]]), :include_blank => @menu_blank %>
			</div>
			<div class="field">
				<%= f.text_area :hashtag, :placeholder => "#characters, #activities, #objects" %>
			</div>
		</div>
	</div>
	<br /><br />
	<%= f.submit "Save", class: "btn btn-primary btn-large" %> <br /><br />
<% end %>

<script type="text/javascript">
	$(function() {	
		$(".search_button").click(function() {
			$('#selectable').html('Loading...');
			var search_term = $("#search_input").val();
			_500px.api('/photos/search', {term: search_term, sort: "rating", image_size: 2}, function (response) {
			  if (response.success) {  
			    $("#selectable").html('');
			    $.each(response.data.photos, function(i,photo){
			      $("#selectable").append("<li><img src = "+photo.image_url+" /></li>");
			      if ( i == 20 ) return false;
			    });		  
				  $("#selectable li").click(function() {
		  			$(this).addClass("selected").siblings().removeClass("selected");
		  		});
		  		if(response.data.total_pages > 1) {
		  			$("#loadMore").append("<a>Load More...</a>");
		  		}
			  } else {
			  	alert('Unable to complete request: ' + response.status + ' - ' + response.error_message);
			  }
			});
		});
	});
</script>
<script type="text/javascript">
	$('#myTab a:first').tab('show'); 
</script>

